<%- include('../partials/header') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Step 4 - Classroom Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<!-- Navigation Steps -->
<nav class="bg-[#EEEEEE] shadow-md py-4">
  <div class="max-w-7xl mx-auto px-6">
    <ul class="flex justify-between text-sm md:text-base text-[#0F044C] font-medium">
      <li class="font-bold px-4">Step 1: <a href="/step1" class="hover:text-[#0F044C]">Setup</a></li>
      <li class="font-bold px-4">Step 2: <a href="/step2" class="hover:text-[#0F044C]">Subjects</a></li>
      <li class="font-bold px-4">Step 3: <a href="/step3" class="hover:text-[#0F044C]">Courses</a></li>
      <li class="text-[#0F044C] font-bold px-4">Step 4: Classrooms</li>
      <li class="px-4"><a href="/step5" class="hover:text-[#0F044C]">Step 5: Teachers</a></li>
      <li class="px-4"><a href="/step6" class="hover:text-[#0F044C]">Step 6: Generate</a></li>
    </ul>
  </div>
</nav>

<!-- Page Heading -->
<div class="flex items-center justify-center my-10 relative">
  <!-- Back arrow button on the left -->
   <a href="/step3">
  <button type="button" class="absolute top-0 left-7 text-1xl bg-[#141E61] text-white px-6 py-2 rounded-md hover:bg-[#787A91] transition duration-300">
    ← Back
  </button>
  </a>

<div class="text-center">
  <h1 class="text-3xl font-bold text-[#0F044C]">Step 4: Classroom Details</h1>
  <p class="text-[#141E61] mt-2">Configure your classroom preferences below</p>
</div>
</div>

<!-- Form Card -->
<div class="max-w-3xl mx-auto bg-[#EEEEEE] shadow-lg rounded-lg p-8">
  <form action="/step4/add-classroom" method="POST" class="space-y-6">

    <!-- Type Selector -->
    <div>
      <label class="block text-[#0F044C] font-medium mb-1">Type</label>
      <select name="classOrLab" onchange="toggleRoomFields(this)"
              class="w-full border border-gray-400 rounded-md px-4 py-2 focus:ring-[#0F044C] focus:ring-2">
        <option value="class">Classroom</option>
        <option value="lab">Lab</option>
      </select>
    </div>

    <!-- Room Number & Building -->
    <div class="grid grid-cols-2 gap-6">
      <div>
        <label class="block text-[#0F044C] font-medium mb-1">Room Number</label>
        <input type="text" name="roomNumber" required placeholder="Room Number"
               class="w-full border border-gray-400 rounded-md px-4 py-2 focus:ring-[#0F044C] focus:ring-2" />
      </div>
      <div>
        <label class="block text-[#0F044C] font-medium mb-1">Building</label>
        <input type="text" name="building" required placeholder="Building"
               class="w-full border border-gray-400 rounded-md px-4 py-2 focus:ring-[#0F044C] focus:ring-2" />
      </div>
    </div>

    <!-- Capacity for Classrooms -->
    <div id="classroomFields">
      <label class="block text-[#0F044C] font-medium mb-1">Capacity</label>
      <select name="capacityRange"
              class="w-full border border-gray-400 rounded-md px-4 py-2 focus:ring-[#0F044C] focus:ring-2">
        <option value="30-45">30–45</option>
        <option value="60-80">60–80</option>
      </select>
    </div>

    <!-- Lab Type -->
    <div id="labFields" style="display:none;">
      <label class="block text-[#0F044C] font-medium mb-1">Lab Type</label>
      <input type="text" name="labType" placeholder="Lab Type (e.g. Computer, Electrical)"
             class="w-full border border-gray-400 rounded-md px-4 py-2 focus:ring-[#0F044C] focus:ring-2" />
    </div>

    <!-- Submit Buttons -->
    <div class="text-right">
      <button type="submit"
              class="bg-[#141E61] text-white px-6 py-2 rounded-md hover:bg-[#787A91] transition duration-300">
        Add Classroom
      </button>
    </div>
  </form>
  <form action="/step4/next" method="POST" class="mt-6 text-right">
    <button type="button"
             id="toggleRoomListBtn"
              onclick="toggleRoomList()"
              class="bg-[#141E61] text-white px-6 py-2 rounded-md hover:bg-[#787A91] transition duration-300">
        View Classrooms
      </button>
    <button type="submit"
            class="bg-[#141E61] text-white px-6 py-2 rounded-md hover:bg-[#787A91] transition duration-300">
      Save & Continue ➡
    </button>
  </form>
</div>

<!-- Room List -->
<div id="roomListContainer" class="max-w-4xl mx-auto mt-8">
  <div id="roomList" class="hidden mt-4">
    <% if (classrooms.length > 0) { %>
      <table class="w-full border-collapse border border-gray-400 rounded-lg shadow-lg">
        <thead class="bg-[#787A91] text-white">
          <tr>
            <th class="px-6 py-3">Type</th>
            <th class="px-6 py-3">Room No</th>
            <th class="px-6 py-3">Building</th>
            <th class="px-6 py-3">Capacity</th>
            <th class="px-6 py-3">Lab Type</th>
            <th class="px-6 py-3">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% classrooms.forEach(room => { %>
            <tr class="border-b border-gray-300">
              <td class="px-6 py-3"><%= room.classOrLab %></td>
              <td class="px-6 py-3"><%= room.roomNumber %></td>
              <td class="px-6 py-3"><%= room.building %></td>
              <td class="px-6 py-3"><%= room.classOrLab === 'class' ? room.capacityRange : '-' %></td>
              <td class="px-6 py-3"><%= room.classOrLab === 'lab' ? room.labType : '-' %></td>
              <td class="px-6 py-3 flex space-x-3 justify-center">
                <button type="button"
                        onclick="openEditModal(this)"
                        data-id="<%= room._id %>"
                        data-type="<%= room.classOrLab %>"
                        data-room="<%= room.roomNumber %>"
                        data-building="<%= room.building %>"
                        data-capacity="<%= room.capacityRange %>"
                        data-labtype="<%= room.labType %>"
                        class="text-[#0F044C] border border-[#0F044C] px-4 py-2 rounded hover:bg-[#0F044C] hover:text-white">
                  Edit
                </button>
                <form action="/step4/delete/<%= room._id %>" method="POST">
                  <button type="submit"
                          class="text-red-600 border border-red-600 px-4 py-2 rounded hover:bg-red-600 hover:text-white">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p class="text-[#0F044C] mt-2">No rooms or labs found.</p>
    <% } %>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md max-h-[90vh] overflow-y-auto">
    <h3 class="text-xl font-semibold mb-4 text-[#0F044C]">Edit Classroom/Lab</h3>
    <form id="editRoomForm" method="POST" class="space-y-4">
      <div>
        <label class="block font-medium mb-1 text-[#0F044C]">Type</label>
        <select name="classOrLab" id="editType" onchange="toggleEditFields(this)"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0F044C]">
          <option value="class">Classroom</option>
          <option value="lab">Lab</option>
        </select>
      </div>

      <div>
        <label class="block font-medium mb-1 text-[#0F044C]">Room Number</label>
        <input type="text" name="roomNumber" id="editRoomNumber" required
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0F044C]" />
      </div>

      <div>
        <label class="block font-medium mb-1 text-[#0F044C]">Building</label>
        <input type="text" name="building" id="editBuilding" required
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0F044C]" />
      </div>

      <div id="editClassroomFields">
        <label class="block font-medium mb-1 text-[#0F044C]">Capacity</label>
        <select name="capacityRange" id="editCapacity"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0F044C]">
          <option value="30-45">30–45</option>
          <option value="60-80">60–80</option>
        </select>
      </div>

      <div id="editLabFields" class="hidden">
        <label class="block font-medium mb-1">Lab Type</label>
        <input type="text" name="labType" id="editLabType"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0F044C]" />
      </div>

      <div class="flex justify-end gap-3 pt-3">
        <button type="button" onclick="closeEditModal()"
          class="bg-white border border-gray-400 px-5 py-2 rounded-md hover:bg-gray-200">Cancel</button>
        <button type="submit"
          class="bg-[#141E61] hover:bg-[#787A91] text-[#EEEEEE] px-5 py-2 rounded-md">Update</button>
      </div>
    </form>
  </div>
</div>


<script>
  function toggleRoomFields(select) {
    const lab = document.getElementById('labFields');
    const classroom = document.getElementById('classroomFields');
    if (select.value === 'lab') {
      lab.style.display = 'block';
      classroom.style.display = 'none';
    } else {
      lab.style.display = 'none';
      classroom.style.display = 'block';
    }
  }

  function toggleEditFields(select) {
    const lab = document.getElementById('editLabFields');
    const classroom = document.getElementById('editClassroomFields');
    if (select.value === 'lab') {
      lab.classList.remove('hidden');
      classroom.classList.add('hidden');
    } else {
      lab.classList.add('hidden');
      classroom.classList.remove('hidden');
    }
  }

  function openEditModal(button) {
    const modal = document.getElementById('editModal');
    const form = document.getElementById('editRoomForm');

    const id = button.getAttribute('data-id');
    const type = button.getAttribute('data-type');
    const room = button.getAttribute('data-room');
    const building = button.getAttribute('data-building');
    const capacity = button.getAttribute('data-capacity');
    const labType = button.getAttribute('data-labtype');

    form.action = `/step4/edit/${id}`;
    document.getElementById('editType').value = type;
    document.getElementById('editRoomNumber').value = room;
    document.getElementById('editBuilding').value = building;
    document.getElementById('editCapacity').value = capacity || '30-45';
    document.getElementById('editLabType').value = labType || '';

    toggleEditFields(document.getElementById('editType'));
    modal.classList.remove('hidden');
  }

  function closeEditModal() {
    document.getElementById('editModal').classList.add('hidden');
  }

 function toggleRoomList() {
  const list = document.getElementById('roomList');
  const btn = document.getElementById('toggleRoomListBtn');

  list.classList.toggle('hidden');

  if (!list.classList.contains('hidden')) {
    btn.textContent = 'Hide Classrooms';
    setTimeout(() => {
      list.scrollIntoView({ behavior: 'smooth' });
    }, 100);
  } else {
    btn.textContent = 'View Classrooms';
  }
}


</script>

<%- include('../partials/footer') %>